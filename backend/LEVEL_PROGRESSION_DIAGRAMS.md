# Level Progression Flow - Visual Guide

## ğŸ¯ Message Counting Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NEW MESSAGE ARRIVES                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Current Level = ?     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
            â–¼               â–¼               â–¼
        Level 1         Level 2         Level 3
            â”‚               â”‚               â”‚
            â”‚               â”‚               â”‚
            â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ level2_count++   â”‚ â”‚ Check L2     â”‚ â”‚ No more  â”‚
â”‚                  â”‚ â”‚ consent?     â”‚ â”‚ levels   â”‚
â”‚ If count == 5    â”‚ â”‚              â”‚ â”‚          â”‚
â”‚ â†’ Trigger L2     â”‚ â”‚ Both ACCEPT? â”‚ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚
                    â–¼               â–¼
                âœ… YES          âŒ NO
                    â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ level3_count++â”‚                    â”‚ âŒ BLOCKED       â”‚
â”‚               â”‚                    â”‚ level3_count = 0 â”‚
â”‚ If count == 5 â”‚                    â”‚ (no increment)   â”‚
â”‚ â†’ Trigger L3  â”‚                    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Consent State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LEVEL 2 CONSENT                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   PENDING   â”‚ â† Initial state
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚
    User clicks         User clicks
       "YES"               "NO"
         â”‚                   â”‚
         â–¼                   â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ACCEPTED  â”‚      â”‚DECLINED_TEMPORARYâ”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â”‚                     â”‚
        â”‚            User clicks "Share now"
        â”‚            on banner
        â”‚                     â”‚
        â”‚                     â–¼
        â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ACCEPTED  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Counter Reset Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LEVEL 3 COUNTER LIFECYCLE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Initial State
   level3_message_count = 0
   User1 consent = PENDING
   User2 consent = PENDING
   
         â”‚
         â”‚ User1 accepts Level 2
         â–¼
         
2. One User Accepted
   level3_message_count = 0 (still BLOCKED)
   User1 consent = ACCEPTED
   User2 consent = PENDING
   
         â”‚
         â”‚ User2 accepts Level 2
         â–¼
         
3. âœ… BOTH ACCEPTED â†’ RESET TRIGGERED
   level3_message_count = 0 (RESET to fresh start)
   User1 consent = ACCEPTED
   User2 consent = ACCEPTED
   current_level = 2
   
         â”‚
         â”‚ Messages sent
         â–¼
         
4. Counting Starts
   level3_message_count++ (1, 2, 3, 4, 5...)
   
         â”‚
         â”‚ When count reaches 5
         â–¼
         
5. Level 3 Triggers
   level3_message_count = 5
   â†’ Show Level 3 popup to both users
```

---

## ğŸš¦ Decision Tree

```
Message Received
    â”‚
    â””â”€> Is current_level == 1?
        â”‚
        â”œâ”€> YES: Increment level2_message_count
        â”‚   â””â”€> Is level2_message_count == 5?
        â”‚       â”œâ”€> YES: Trigger Level 2 popup
        â”‚       â””â”€> NO: Continue
        â”‚
        â””â”€> NO: Is current_level == 2?
            â”‚
            â”œâ”€> YES: Check Level 2 consent
            â”‚   â”‚
            â”‚   â”œâ”€> Both ACCEPTED?
            â”‚   â”‚   â”œâ”€> YES: Increment level3_message_count
            â”‚   â”‚   â”‚   â””â”€> Is level3_message_count == 5?
            â”‚   â”‚   â”‚       â”œâ”€> YES: Trigger Level 3 popup
            â”‚   â”‚   â”‚       â””â”€> NO: Continue
            â”‚   â”‚   â”‚
            â”‚   â”‚   â””â”€> NO: âŒ BLOCK - Don't count
            â”‚   â”‚       â””â”€> Log: "[Level3] BLOCKED - consent not accepted"
            â”‚   â”‚
            â”‚   â””â”€> Continue
            â”‚
            â””â”€> NO: No more levels
```

---

## ğŸ“ˆ State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONVERSATION LIFECYCLE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1        â”‚  level2_count = 0, level3_count = 0
â”‚ 0-4 messages   â”‚  Both consent = PENDING
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5th message sent
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 2 POPUP  â”‚  level2_count = 5, level3_count = 0
â”‚ (Both users)   â”‚  Show consent popup to both
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                  â”‚
    Both accept        One/Both decline   Continue chatting
         â”‚                  â”‚              (100 messages)
         â–¼                  â–¼                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ Level 2 ACTIVE  â”‚  â”‚ Orange Bannerâ”‚         â”‚
â”‚ Counter RESET   â”‚  â”‚ Shows "Share"â”‚         â”‚
â”‚ level3_count=0  â”‚  â”‚              â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
         â”‚                  â”‚                  â”‚
         â”‚                  â”‚                  â–¼
         â”‚                  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚           â”‚ level3 = 0  â”‚
         â”‚                  â”‚           â”‚ (BLOCKED!)  â”‚
         â”‚                  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â”‚              Eventually          Later clicks
         â”‚              clicks "Yes"         "Share now"
         â”‚                  â”‚                  â”‚
         â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚
         â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 5 messages sent
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 3 POPUP  â”‚  level3_count = 5
â”‚ (Both users)   â”‚  Show consent popup
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ® Example Timelines

### Timeline A: Immediate Acceptance
```
Time    Event                       L2 Count  L3 Count  L2 Consent    L3 Trigger?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0:00    Match created               0         0         PENDING       âŒ
0:05    Message 1                   1         0         PENDING       âŒ
0:10    Message 2                   2         0         PENDING       âŒ
0:15    Message 3                   3         0         PENDING       âŒ
0:20    Message 4                   4         0         PENDING       âŒ
0:25    Message 5 â†’ L2 POPUP       5         0         PENDING       âŒ
0:30    Both click "Yes"            5         0â†’0       ACCEPTED      âŒ
0:35    Message 6                   5         1         ACCEPTED      âŒ
0:40    Message 7                   5         2         ACCEPTED      âŒ
0:45    Message 8                   5         3         ACCEPTED      âŒ
0:50    Message 9                   5         4         ACCEPTED      âŒ
0:55    Message 10 â†’ L3 POPUP      5         5         ACCEPTED      âœ…
```

### Timeline B: Delayed Acceptance
```
Time    Event                       L2 Count  L3 Count  L2 Consent    L3 Trigger?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0:00    Match created               0         0         PENDING       âŒ
0:05    Message 1-5 â†’ L2 POPUP     5         0         PENDING       âŒ
0:10    User clicks "No"            5         0         DECLINED      âŒ
0:15    Message 6                   5         0         DECLINED      âŒ BLOCKED
0:20    Message 7-100               5         0         DECLINED      âŒ BLOCKED
1:00    User clicks "Yes"           5         0â†’0       ACCEPTED      âŒ RESET!
1:05    Message 101                 5         1         ACCEPTED      âŒ
1:10    Message 102-105             5         2-5       ACCEPTED      âŒ
1:15    Message 105 â†’ L3 POPUP     5         5         ACCEPTED      âœ…
```

---

## ğŸ”‘ Key Takeaways

1. **Level 2 always counts** - No prerequisites
2. **Level 3 only counts when both users accept Level 2** - Strictly enforced
3. **Counter resets when consent granted** - Fresh start for fairness
4. **Frontend driven by backend state** - No local logic, reduces bugs

**Last Updated:** February 3, 2026
